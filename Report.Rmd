---
title: "Advanced Timber"
author: "Franca Kaba GÃ³mez"
date: "2025-07-07"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
make_variables <- function(est,n=1)
{ x<-random(rho=est, n=n)
for(i in colnames(x)) assign(i,
                             as.numeric(x[1,i]),envir=.GlobalEnv)}
```

Idea: sell some timber each year from n=30, then continue.
```{r advanced timber, include=FALSE}

model_function_group53 <- function() {
  #call variables
  Variables_intervention<- read.csv("Variables_Agroforestry_Timber_clean.csv", row.names = 1)
  make_variables(as.estimate(Variables_intervention))
  #creating constant variables
  n_years <- 50
  n_years_first_harvest<-30
  n_years_establishment<-5
 
  
  farm_size_n<-rep(farm_size, n_years)
  inflation_n<-runif(n_years, min=0.25, max=7.5)
  
  #creating risks modified by tree presence
  
  dry_years <- rep(0, n_years)
  dry_years <- c(chance_event(
    chance = dry_year_incidence,
    value_if = 1 - dry_year_damage*dry_year_damage_establishment,
    value_if_not = 1,
    n = n_years_establishment),chance_event(
    chance = dry_year_incidence,
    value_if = 1 - dry_year_damage*dry_year_damage_establishment,
    value_if_not = 1,
    n = n_years-n_years_establishment))

  
  rainy_years <- rep(0, n_years)
  rainy_years <- c(chance_event(
    chance = heavy_rainfall_incidence,
    value_if = 1 - heavy_rainfall_damage,
    value_if_not = 1,
    n = n_years_establishment), chance_event(
    chance = heavy_rainfall_incidence,
    value_if = 1 - heavy_rainfall_damage*heavy_rainfall_damage_established,
    value_if_not = 1,
    n = n_years-n_years_establishment)
  )
  
  cocoa_pest_and_diseases <- rep(0, n_years)
  cocoa_pest_and_diseases <-
    chance_event(
      chance = cocoa_pest_and_disease_incidence,
      value_if = 1 - cocoa_pest_and_disease_damage,
      value_if_not = 1,
      n = n_years)
  
#considering costs
  #cocoa
  labor_price_n <- rep(0, n_years)
  labor_price_n <- vv(labor_price, 5, n_years, relative_trend = inflation_rate_cameroon)
  family_labor_n <- rep(0, n_years)
  family_labor_n <- rep(family_labor, n_years)
  labor_persons_full_time_n <- rep(labor_persons_full_time, n_years)
  labor_persons_seasonal_n <- rep(labor_persons_seasonal, n_years)
  
  labor_cost  <-labor_persons_full_time_n * 12 * labor_price_n+
  labor_persons_seasonal_n * 5 * labor_price_n +
  family_labor * labor_price * 12
  
  fertilizer_cost_n <- rep(0, n_years)
  fertilizer_cost_n <- vv(fertilizer_cost, 20, n_years)
  fertilizer_amount_n <- rep(0, n_years)
  fertilizer_amount_n <- vv(fertilizer_amount, 30, n_years, relative_trend = inflation_rate_cameroon)
  fertilizer_effect_n <- vv(fertilizer_effect, 10, n_years, relative_trend = inflation_rate_cameroon)
  
  pesticide_cost_n <- rep(0, n_years)
  pesticide_cost_n <- vv(pesticide_cost, 20, n_years, relative_trend = inflation_rate_cameroon)
  pesticide_frequency_n <- rep(pesticide_frequency, n_years)
  
  pesticide_and_fertilizer_cost <-
    pesticide_cost_n * farm_size_n * pesticide_frequency_n + fertilizer_amount_n *
    fertilizer_cost_n
  
    overall_cost_cocoa <- pesticide_and_fertilizer_cost + labor_cost

  #timber (additional)
  seedlings_cost<-c(tree_seedlings*tree_density*farm_size)
  transport_cost<-c(seedling_and_equipment_transport)
  establishment_labor_cost<-c(labor_persons_establishment*(labor_price_n[1])*farm_size*
                              3)
  establishment_cost<-seedlings_cost+transport_cost+establishment_labor_cost
  maintenance_labor_persons<-c(farm_size_n)
  maintenance_labor_cost<-maintenance_labor_persons*labor_price_n
  harvest_cost<-(harvest_material+labor_persons_harvest*labor_price_n[n_years]*
                   farm_size*3)/n_years_first_harvest
  harvest_cost_n<-c(rep(0, n_years_first_harvest),vv(harvest_cost, 5, (n_years-n_years_first_harvest), relative_trend=inflation_rate_cameroon))
  
  overall_cost_timber<-c(establishment_cost,maintenance_labor_cost[2:(n_years-1)],
                         harvest_cost)
#considering income
  #cocoa
  cocoa_harvest_n <- rep(0, n_years)
  cocoa_harvest_n <- vv(cocoa_harvest, 5, n_years)
  
  cocoa_price_world_market_n <- rep(0, n_years)
  cocoa_price_world_market_n <-
    vv(cocoa_price_world_market, 30, n_years, relative_trend=inflation_rate_world)
  cocoa_price_percent_farmgate_n <- rep(0, n_years)
  cocoa_price_percent_farmgate_n <- vv(cocoa_price_percent_farmgate, 10, n_years)
  pesticide_effect_n <- rep(0, n_years)
  pesticide_effect_n <- rep(pesticide_effect, n_years)
  pest_increase_rain_n <- rep(0, n_years)
  pest_increase_rain_n <- rep(pest_increase_rain, n_years)
  yield_impact<-c(vv(impact_trees_cocoa_establishment, 5, n_years_establishment),
                  vv(impact_trees_cocoa, 10, n_years-n_years_establishment))
  cocoa_farm_harvest_complete <-
    farm_size_n * cocoa_harvest_n * dry_years * rainy_years * cocoa_pest_and_diseases*
    (pesticide_frequency_n*                                           
       pesticide_effect_n) * (fertilizer_amount_n * fertilizer_effect_n)*yield_impact
    income_cocoa <- cocoa_farm_harvest_complete * cocoa_price_world_market_n *
      cocoa_price_percent_farmgate_n
  
  #timber
  dt_timber_diameter<-vv(tree_growth_diam, 5, n_years)
  harvest_years <- n_years_first_harvest:n_years
  harvest_diameter <- sapply(harvest_years, function(y) sum(dt_timber_diameter[1:y]))/10
  dt_timber_height<-vv(tree_growth_height,5,n_years)
  harvest_height<-sapply(harvest_years, function(y) sum(dt_timber_height[1:y]))
  timber_cm3<-((farm_size*tree_density)/30)*(harvest_diameter/2)^2*pi*harvest_height
  timber_m3<-timber_cm3/1000000
  timber_price_n<-vv(tree_price, 20, n_years, relative_trend = inflation_rate_world)
  income_timber<-c(rep(0,n_years_first_harvest), c(timber_m3*timber_price_n[n_years_first_harvest:n_years])/30)
  
#creating final cashflows and distributions
   final_cashflow <- (income_cocoa)+(income_timber) - (overall_cost_cocoa+overall_cost_timber)
  # Generate the list of outputs from the Monte Carlo simulation
  final_result <- sum(income_cocoa+income_timber - overall_cost_cocoa+overall_cost_timber)
  final_result_cocoa <- sum(income_cocoa - overall_cost_cocoa)
 return(list(final_result_af = final_result,
             final_cashflow_af = final_cashflow))
}

```

