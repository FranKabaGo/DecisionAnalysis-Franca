---
title: "Final_Draft"
author: "Franca Kaba GÃ³mez"
date: "2025-06-22"
output: html_document
bibliography: references.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(decisionSupport)
library(ggplot2)
library(kableExtra)
library(ggplot2)
library(plyr)
library(dplyr)
```

##Introduction  
## Variables  

```{r variables, echo=FALSE}
Variables_Group5<-read.csv("Variables_Group5.csv", row.names = 1)
knitr::kable(Variables_Group5)%>%
  kable_classic(full_width = F, html_font = "Cambria")
make_variables <- function(est,n=1)
{ x<-random(rho=est, n=n)
for(i in colnames(x)) assign(i,
                             as.numeric(x[1,i]),envir=.GlobalEnv)
}

```
```{r include=FALSE}
make_variables(as.estimate(Variables_Group5))

```

## Applying the decision support function
```{r Chance, echo = FALSE}

model_function_group52 <- function() {
  #call variables
  read.csv("Variables_Group5.csv", row.names = 1)
  make_variables(as.estimate(Variables_Group5))
  #creating empty variables to integrate time
  n_years <- 30
  farm_size_30 <- rep(0, n_years)
  farm_size_30 <- rep(farm_size, n_years)
  
  #risks
  dry_years <- rep(0, n_years)
  dry_years <- chance_event(
    chance = dry_year_incidence,
    value_if = 1 - dry_year_damage,
    value_if_not = 1,
    n = n_years)

  
  rainy_years <- rep(0, n_years)
  rainy_years <- chance_event(
    chance = heavy_rainfall_incidence,
    value_if = 1 - heavy_rainfall_damage,
    value_if_not = 1,
    n = n_years
  )
  
  cocoa_pest_and_diseases <- rep(0, n_years)
  cocoa_pest_and_diseases <-
    chance_event(
      chance = cocoa_pest_and_disease_incidence,
      value_if = 1 - cocoa_pest_and_disease_damage,
      value_if_not = 1,
      n = n_years
    )
  
  #costs
  labor_price_30 <- rep(0, n_years)
  labor_price_30 <- vv(labor_price, 5, n_years, relative_trend = 1)
  family_labor_30 <- rep(0, n_years)
  family_labor_30 <- rep(family_labor, n_years)
  labor_persons_full_time_30 <-
    rep(labor_persons_full_time, n_years)
  labor_persons_seasonal_30 <- rep(labor_persons_seasonal, n_years)
  
  fertilizer_cost_30 <- rep(0, n_years)
  fertilizer_cost_30 <- vv(fertilizer_cost, 20, n_years)
  fertilizer_amount_30 <- rep(0, n_years)
  fertilizer_amount_30 <- vv(fertilizer_amount, 30, n_years)
  fertilizer_effect_30 <- vv(fertilizer_effect, 10, n_years)
  
  pesticide_cost_30 <- rep(0, n_years)
  pesticide_cost_30 <- vv(pesticide_cost, 20, n_years)
  pesticide_frequency_30 <- rep(pesticide_frequency, n_years)
  
  cocoa_harvest_30 <- rep(0, n_years)
  cocoa_harvest_30 <- vv(cocoa_harvest, 5, n_years)
  
  cocoa_price_world_market_30 <- rep(0, n_years)
  cocoa_price_world_market_30 <-
    vv(cocoa_price_world_market, 30, absolute_trend = 5, n_years)
  cocoa_price_percent_farmgate_30 <- rep(0, n_years)
  cocoa_price_percent_farmgate_30 <-
    vv(cocoa_price_percent_farmgate, 10, relative_trend = 1, n_years)
  pesticide_effect_30 <- rep(0, n_years)
  pesticide_effect_30 <- rep(pesticide_effect, n_years)
  pest_increase_rain_30 <- rep(0, n_years)
  pest_increase_rain_30 <- rep(pest_increase_rain, n_years)
  
  
  #formula for the harvest considering all production risks and management options
  
  
  #calculating the actual cocoa harvest per farm
  cocoa_farm_harvest_complete <-
    farm_size * cocoa_harvest_30 * dry_years * rainy_years * cocoa_pest_and_diseases * (pesticide_frequency_30 * 1 +
                                                                                          pesticide_effect_30) * (fertilizer_amount_30 * fertilizer_effect_30)
  #income from cocoa
  income <- cocoa_farm_harvest_complete * cocoa_price_world_market_30 * cocoa_price_percent_farmgate_30
  #labor_cost
  labor_cost  <-
    labor_persons_full_time_30 * 12 * labor_price_30 + labor_persons_seasonal_30 * 5 * labor_price_30 +
    family_labor * labor_price * 12
  
  pesticide_and_fertilizer_cost <-
    pesticide_cost_30 * farm_size_30 * pesticide_frequency_30 + fertilizer_amount_30 *
    fertilizer_cost_30
  
  overall_cost <- pesticide_and_fertilizer_cost + labor_cost
  
  # Estimate the final results from the model
  final_result <- income - overall_cost
  # Generate the list of outputs from the Monte Carlo simulation
  final_result <- sum(income - overall_cost)
 return(list(final_result = final_result))
}


#applying the decision support package
mc_simulation2 <-
  mcSimulation(
    estimate = as.estimate(Variables_Group5),
    model_function = model_function_group52,
    numberOfModelRuns = 1000,
    functionSyntax = "plainNames"
  )
plot_distributions(
  mcSimulation_object = mc_simulation2,
  vars = "final_result",
  method = "boxplot_density",
  old_names = "final_result",
  new_names = "Outcome distribution for profits"
)

```


##Making a better plot
```{r}
# Extract simulation results
simulation_df <- mc_simulation2$y
# Build the custom plot
ggplot(simulation_df, aes(x = final_result)) +
  # Density curve
  geom_density(fill = "skyblue", alpha = 0.4) +

   scale_x_continuous(labels = scales::comma)+
  theme_classic()
```

